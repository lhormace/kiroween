# Health Chat Advisor - ローカル実行ガイド

このガイドでは、AWSを使わずにローカル環境でHealth Chat Advisorを実行する方法を説明します。

## 🚀 クイックスタート

### 1. 環境変数の設定

ターミナルで以下のコマンドを実行します：

```bash
export JWT_SECRET="local-development-secret-key-12345"
export MCP_ENDPOINT="http://localhost:3000"
```

### 2. アプリケーションの起動

```bash
mvn spring-boot:run
```

### 3. ブラウザでアクセス

アプリケーションが起動したら、ブラウザで以下にアクセス：

```
http://localhost:8081
```

ログインページが表示されます。

## 📝 初回ユーザー登録

現在の実装では、ユーザーデータはS3に保存される設計になっています。
ローカル実行では、以下のテストユーザーでログインできます：

- **ユーザー名**: `testuser`
- **パスワード**: `password123`

## ⚠️ 現在の制限事項

ローカル実行では以下の機能に制限があります：

### 1. データ永続化
- S3への保存機能は動作しません
- データはメモリ内に一時保存されます（再起動で消えます）

### 2. MCP連携
- MCPサーバーが `http://localhost:3000` で動作している必要があります
- MCPサーバーがない場合、デフォルトのアドバイスが表示されます

### 3. Lambda関数
- Lambda関数は使用されず、SpringBootコントローラーが直接処理します

## 🔧 ローカル実行用の調整（オプション）

より完全なローカル実行環境を構築する場合：

### オプション1: ローカルファイルシステムを使用

S3の代わりにローカルファイルシステムを使用するように調整できます。

`application.properties`に以下を追加：

```properties
# Local file storage
storage.type=local
storage.local.path=./data
```

### オプション2: MCPサーバーなしで実行

MCPサーバーがない場合、デフォルトのアドバイスが使用されます。
これは既に実装されているので、特別な設定は不要です。

## 📱 使い方

### 1. ログイン

ブラウザで `http://localhost:8081` にアクセスし、ログインします。

### 2. メッセージ送信

チャット画面で健康情報を入力します。例：

```
今日の体重は65kg、体脂肪率は18%です。
朝食にご飯と卵を食べました。
30分ジョギングしました。
```

### 3. グラフ表示

「グラフを表示」ボタンをクリックすると、体重と体脂肪率の推移が表示されます。

## 🐛 トラブルシューティング

### ポート8081が既に使用されている

別のポートを使用する場合：

```bash
mvn spring-boot:run -Dspring-boot.run.arguments=--server.port=8082
```

### ログインできない

現在の実装では、ユーザー認証はS3に依存しています。
ローカル実行では、認証をバイパスするか、テストユーザーを使用してください。

### データが保存されない

ローカル実行では、データはメモリ内に保存され、アプリケーション再起動で消えます。
これは正常な動作です。

## 🔄 開発モード

開発中にコードを変更した場合：

```bash
# アプリケーションを停止（Ctrl+C）
# 再ビルドして起動
mvn clean spring-boot:run
```

## 📊 ログの確認

アプリケーションのログはコンソールに出力されます。
詳細なログを確認する場合：

```bash
mvn spring-boot:run -Dlogging.level.com.health.chat=DEBUG
```

## 🎯 次のステップ

ローカルで動作確認ができたら：

1. **AWS環境へのデプロイ** - `DEPLOYMENT.md`を参照
2. **本番用の設定** - セキュリティ設定の強化
3. **データベースの追加** - より永続的なストレージの実装

## 💡 ヒント

- 初回起動時は依存関係のダウンロードに時間がかかる場合があります
- ブラウザのキャッシュをクリアすると、UIの問題が解決することがあります
- MCPサーバーがなくても基本機能は動作します

